# /biped 名前空間で controller_manager ノードの種類を宣言
/biped/controller_manager:
  ros__parameters:
    update_rate: 1000  # 制御ループ周期[Hz]（高すぎるとCPU負荷増）
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster  # /biped/joint_states を出す標準ブロードキャスタ
    leg_jtc:
      type: joint_trajectory_controller/JointTrajectoryController  # PID内蔵JTC（本命）

# JSB の個別パラメータ（今回は空）
/biped/joint_state_broadcaster:
  ros__parameters: {}

# 右脚3関節を effort 駆動でJTCに登録（PIDはここで設定）
/biped/leg_jtc:
  ros__parameters:
    joints: [
      right_hip_joint, right_knee_joint, right_ankle_joint,
      left_hip_joint,  left_knee_joint,  left_ankle_joint
    ]
    command_interfaces: [effort]         # 位置誤差→PID→トルク(effort)に変換して指令
    state_interfaces:   [position, velocity]  # JTCが参照する状態（position/velocity）
    state_publish_rate: 50.0             # controller_state の出力周期[Hz]
    allow_partial_joints_goal: false     # 全関節に同数サンプルの軌道点を要求（安全側）
    constraints:
      goal_time: 0.0                     # ゴール到達に許される遅延（0で厳しめ）
      stopped_velocity_tolerance: 0.005   # 停止判定の速度しきい値[rad/s]

    # ★PID（叩き台。まずは全体0.5倍から始め、P→D→Iの順で調整）
    gains:
      right_hip_joint:   {p: 140.0, d: 10.0, i: 0.0, i_clamp: 0.0}   # i_clamp=積分の上限
      right_knee_joint:  {p: 60.0, d: 3.0, i: 0.0, i_clamp: 0.0}
      right_ankle_joint: {p: 5.0, d: 0.06, i: 0.0, i_clamp: 0.0}
      left_hip_joint:    {p: 140.0, d: 10.0, i: 0.0, i_clamp: 0.0}
      left_knee_joint:   {p: 60.0, d: 3.0, i: 0.0, i_clamp: 0.0}
      left_ankle_joint:  {p: 5.0, d: 0.06, i: 0.0, i_clamp: 0.0}
    open_loop_control: false             # 閉ループ（誤差→PID）で駆動する設定

