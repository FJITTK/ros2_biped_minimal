<?xml version="1.0"?>
<robot name="minimal_biped">
  <material name="grey"><color rgba="0.7 0.7 0.7 1.0"/></material>
  <link name="torso">
    <inertial>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <mass value="10"/>            
      <inertia ixx="0.05" ixy="0" ixz="0" iyy="0.05" iyz="0" izz="0.05"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <geometry><box size="0.1 0.1 0.3"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <geometry><box size="0.1 0.1 0.3"/></geometry>
    </collision>
  </link>
  
  <joint name="right_hip_joint" type="revolute">
    <parent link="torso"/>
    <child  link="right_hip_link"/>
    <origin xyz="0 -0.05 0.05" rpy="0 0 0"/>   
    <axis xyz="0 1 0"/>                        
    <limit lower="-1.5"
           upper="1.5"
           effort="200" velocity="3.0"/>     
    <dynamics damping="0.2" friction="0.1"/>   
  </joint>

  <link name="right_hip_link">
    <inertial>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <mass value="2.0"/>                      
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
    </inertial>
    <visual>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
    </collision>
  </link>
  
  <joint name="right_knee_joint" type="revolute">
    <parent link="right_hip_link"/>
    <child  link="right_knee_link"/>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>       
    <axis xyz="0 1 0"/>                        
    <limit lower="0.0"
           upper="2.0"
           effort="200" velocity="3.0"/>   
    <dynamics damping="0.2" friction="0.1"/>     
  </joint>

  <link name="right_knee_link">
    <inertial>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <mass value="2.0"/>                      
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
    </inertial>
    <visual>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
    </collision>
  </link>
  
  <joint name="right_ankle_joint" type="revolute">
    <parent link="right_knee_link"/>
    <child  link="right_foot"/>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>   
    <axis xyz="0 1 0"/>                        
    <limit lower="-1.5"
           upper="1.5"
           effort="200" velocity="3.0"/>     
    <dynamics damping="0.2" friction="0.1"/>   
  </joint>

  <link name="right_foot">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="1.0"/>                      
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry><box size="0.06 0.03 0.02"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry><box size="0.06 0.03 0.02"/></geometry>
    </collision>
  </link>
  
  <joint name="left_hip_joint" type="revolute">
    <parent link="torso"/>
    <child  link="left_hip_link"/>
    <origin xyz="0 0.05 0.05" rpy="0 0 0"/>   
    <axis xyz="0 1 0"/>                        
    <limit lower="-1.5"
           upper="1.5"
           effort="200" velocity="3.0"/>
    <dynamics damping="0.2" friction="0.1"/>        
  </joint>

  <link name="left_hip_link">
    <inertial>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <mass value="2.0"/>                      
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
    </inertial>
    <visual>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
    </collision>
  </link>
  
  <joint name="left_knee_joint" type="revolute">
    <parent link="left_hip_link"/>
    <child  link="left_knee_link"/>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>       
    <axis xyz="0 1 0"/>                        
    <limit lower="0.0"
           upper="2.0"
           effort="200" velocity="3.0"/>
    <dynamics damping="0.01" friction="0.1"/>        
  </joint>

  <link name="left_knee_link">
    <inertial>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <mass value="2.0"/>                      
      <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
    </inertial>
    <visual>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 -0.1" rpy="0 0 0"/>
      <geometry><cylinder radius="0.03" length="0.2"/></geometry>
    </collision>
  </link>

  <joint name="left_ankle_joint" type="revolute">
    <parent link="left_knee_link"/>
    <child  link="left_foot"/>
    <origin xyz="0 0 -0.2" rpy="0 0 0"/>   
    <axis xyz="0 1 0"/>                        
    <limit lower="-1.5"
           upper="1.5"
           effort="200" velocity="3.0"/>     
    <dynamics damping="0.01" friction="0.1"/>   
  </joint>

  <link name="left_foot">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="1.0"/>                      
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry><box size="0.06 0.03 0.02"/></geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry><box size="0.06 0.03 0.02"/></geometry>
    </collision>
  </link>

<ros2_control name="biped_system" type="system">
  <hardware>
    <plugin>gazebo_ros2_control/GazeboSystem</plugin>
  </hardware>

  <joint name="left_hip_joint">
    <command_interface name="effort"/>
    <state_interface   name="position"/>
    <state_interface   name="velocity"/>
    <state_interface   name="effort"/>
  </joint>

  <joint name="left_knee_joint">
    <command_interface name="effort"/>
    <state_interface   name="position"/>
    <state_interface   name="velocity"/>
    <state_interface   name="effort"/>
  </joint>

  <joint name="right_hip_joint">
    <command_interface name="effort"/>
    <state_interface   name="position"/>
    <state_interface   name="velocity"/>
    <state_interface   name="effort"/>
  </joint>

  <joint name="right_knee_joint">
    <command_interface name="effort"/>
    <state_interface   name="position"/>
    <state_interface   name="velocity"/>
    <state_interface   name="effort"/>
  </joint>

  <joint name="right_ankle_joint">
    <command_interface name="effort"/>
    <state_interface   name="position"/>
    <state_interface   name="velocity"/>
    <state_interface   name="effort"/>
  </joint>

  <joint name="left_ankle_joint">
    <command_interface name="effort"/>
    <state_interface   name="position"/>
    <state_interface   name="velocity"/>
    <state_interface   name="effort"/>
  </joint>
</ros2_control>

<gazebo>
  <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so">
    <robot_param>robot_description</robot_param>
    <robot_param_node>/biped/robot_state_publisher</robot_param_node>
    <controller_manager_name>controller_manager</controller_manager_name>
    <parameters>/home/tatsu/ros2_ws/install/my_robot_description/share/my_robot_description/config/ros2_control.yaml</parameters>

    <ros>
      <namespace>biped</namespace>
    </ros>
  </plugin>
</gazebo>

<gazebo reference="torso">
  <gravity>true</gravity>
</gazebo>

<gazebo reference="left_foot">
  <mu1>0.9</mu1><mu2>0.8</mu2>     <!-- 静/動摩擦の近似 -->
  <kp>50000</kp><kd>200.0</kd>      <!-- 接触のばね・ダンパ -->
  <minDepth>0.002</minDepth>       <!-- 最小めり込み量 -->
  <maxVel>0.005</maxVel>             <!-- 反発解消の上限速度 -->
</gazebo>
<gazebo reference="right_foot">
  <mu1>0.9</mu1><mu2>0.8</mu2>
  <kp>50000</kp><kd>200.0</kd>
  <minDepth>0.002</minDepth>
  <maxVel>0.005</maxVel>
</gazebo>

</robot>
